BEFORE WE FUCKING HAVE ERROR RELATED TO THIS:
Now, I need to do deep dive into this project, supabase, how the integration work.

In sign up page, when I try to sign up, it's have an error which related to error saving in database.

So, when I said the auth management is using Supabase, do you fucking try to save the user directly to the tables user_profiles? If yes, you fucking wrong.

The auth is handle by supabase, we fucking not save the password or anything in the database. If user sign up is success, it's saved in tables user_pofiles along with the UUID from the authentication management, and all other information.

THE SHORT STORY IS I RUN THIS AND FUCKIGN GIVE ALL INFORMATION.

-- COMPLETE SUPABASE DIAGNOSTIC QUERY
-- Run this in your Supabase SQL Editor to get ALL configuration info

-- 1. ALL RLS POLICIES
SELECT 
    schemaname,
    tablename,
    policyname,
    permissive,
    roles,
    cmd,
    qual,
    with_check
FROM pg_policies
ORDER BY schemaname, tablename, policyname;

-- 2. ALL TRIGGERS
SELECT 
    trigger_schema,
    trigger_name,
    event_object_table,
    action_timing,
    event_manipulation,
    action_statement
FROM information_schema.triggers
WHERE trigger_schema NOT IN ('information_schema', 'pg_catalog')
ORDER BY trigger_schema, event_object_table, trigger_name;

-- 3. ALL FUNCTIONS (including trigger functions)
SELECT 
    routine_schema,
    routine_name,
    routine_type,
    data_type,
    routine_definition
FROM information_schema.routines
WHERE routine_schema NOT IN ('information_schema', 'pg_catalog')
ORDER BY routine_schema, routine_name;

-- 4. AUTH CONFIGURATION (check if table exists)
SELECT 
    table_name 
FROM information_schema.tables 
WHERE table_schema = 'auth' 
    AND table_name = 'config';

-- 4b. AUTH SCHEMA TABLES
SELECT 
    table_name,
    table_type
FROM information_schema.tables 
WHERE table_schema = 'auth'
ORDER BY table_name;

-- 5. TABLE CONSTRAINTS (including foreign keys)
SELECT 
    tc.constraint_name,
    tc.table_schema,
    tc.table_name,
    tc.constraint_type,
    kcu.column_name,
    ccu.table_schema AS foreign_table_schema,
    ccu.table_name AS foreign_table_name,
    ccu.column_name AS foreign_column_name
FROM information_schema.table_constraints tc
LEFT JOIN information_schema.key_column_usage kcu
    ON tc.constraint_name = kcu.constraint_name
    AND tc.table_schema = kcu.table_schema
LEFT JOIN information_schema.constraint_column_usage ccu
    ON ccu.constraint_name = tc.constraint_name
    AND ccu.table_schema = tc.table_schema
WHERE tc.table_schema NOT IN ('information_schema', 'pg_catalog')
ORDER BY tc.table_schema, tc.table_name, tc.constraint_name;

-- 6. USER_PROFILES TABLE STRUCTURE
SELECT 
    column_name,
    data_type,
    is_nullable,
    column_default
FROM information_schema.columns
WHERE table_schema = 'public' 
AND table_name = 'user_profiles'
ORDER BY ordinal_position;

-- 7. AUTH.USERS TABLE RLS STATUS AND STRUCTURE
SELECT 
    schemaname,
    tablename,
    rowsecurity,
    tableowner
FROM pg_tables
WHERE schemaname = 'auth'
AND tablename = 'users';

-- 7b. AUTH.USERS COLUMNS
SELECT 
    column_name,
    data_type,
    is_nullable,
    column_default
FROM information_schema.columns
WHERE table_schema = 'auth' 
AND table_name = 'users'
ORDER BY ordinal_position;

-- 8. ALL SCHEMAS AND TABLES
SELECT 
    schemaname,
    tablename,
    tableowner,
    rowsecurity
FROM pg_tables
WHERE schemaname IN ('public', 'auth')
ORDER BY schemaname, tablename;

| schemaname | tablename        | policyname                                 | permissive | roles    | cmd    | qual                   | with_check                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ---------- | ---------------- | ------------------------------------------ | ---------- | -------- | ------ | ---------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| public     | keyword_rankings | Users can create rankings for own keywords | PERMISSIVE | {public} | INSERT | null                   | ((auth.uid() = user_id) AND (EXISTS ( SELECT 1
   FROM keywords
  WHERE ((keywords.id = keyword_rankings.keyword_id) AND (keywords.user_id = auth.uid())))) AND (EXISTS ( SELECT 1
   FROM sites
  WHERE ((sites.id = keyword_rankings.site_id) AND (sites.user_id = auth.uid())))) AND (EXISTS ( SELECT 1
   FROM workspaces
  WHERE ((workspaces.id = keyword_rankings.workspace_id) AND (workspaces.user_id = auth.uid()))))) |
| public     | keyword_rankings | Users can delete own rankings              | PERMISSIVE | {public} | DELETE | (auth.uid() = user_id) | null                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public     | keyword_rankings | Users can update own rankings              | PERMISSIVE | {public} | UPDATE | (auth.uid() = user_id) | null                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public     | keyword_rankings | Users can view own rankings                | PERMISSIVE | {public} | SELECT | (auth.uid() = user_id) | null                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public     | keywords         | Users can create keywords in own sites     | PERMISSIVE | {public} | INSERT | null                   | ((auth.uid() = user_id) AND (EXISTS ( SELECT 1
   FROM sites
  WHERE ((sites.id = keywords.site_id) AND (sites.user_id = auth.uid())))) AND (EXISTS ( SELECT 1
   FROM workspaces
  WHERE ((workspaces.id = keywords.workspace_id) AND (workspaces.user_id = auth.uid())))))                                                                                                                                                     |
| public     | keywords         | Users can delete own keywords              | PERMISSIVE | {public} | DELETE | (auth.uid() = user_id) | null                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public     | keywords         | Users can update own keywords              | PERMISSIVE | {public} | UPDATE | (auth.uid() = user_id) | null                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public     | keywords         | Users can view own keywords                | PERMISSIVE | {public} | SELECT | (auth.uid() = user_id) | null                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public     | sites            | Users can create sites in own workspaces   | PERMISSIVE | {public} | INSERT | null                   | ((auth.uid() = user_id) AND (EXISTS ( SELECT 1
   FROM workspaces
  WHERE ((workspaces.id = sites.workspace_id) AND (workspaces.user_id = auth.uid())))))                                                                                                                                                                                                                                                                        |
| public     | sites            | Users can delete own sites                 | PERMISSIVE | {public} | DELETE | (auth.uid() = user_id) | null                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public     | sites            | Users can update own sites                 | PERMISSIVE | {public} | UPDATE | (auth.uid() = user_id) | null                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public     | sites            | Users can view own sites                   | PERMISSIVE | {public} | SELECT | (auth.uid() = user_id) | null                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public     | user_profiles    | Users can insert own profile               | PERMISSIVE | {public} | INSERT | null                   | (auth.uid() = user_id)                                                                                                                                                                                                                                                                                                                                                                                                           |
| public     | user_profiles    | Users can update own profile               | PERMISSIVE | {public} | UPDATE | (auth.uid() = user_id) | null                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public     | user_profiles    | Users can view own profile                 | PERMISSIVE | {public} | SELECT | (auth.uid() = user_id) | null                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public     | workspaces       | Users can create workspaces                | PERMISSIVE | {public} | INSERT | null                   | (auth.uid() = user_id)                                                                                                                                                                                                                                                                                                                                                                                                           |
| public     | workspaces       | Users can delete own workspaces            | PERMISSIVE | {public} | DELETE | (auth.uid() = user_id) | null                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public     | workspaces       | Users can update own workspaces            | PERMISSIVE | {public} | UPDATE | (auth.uid() = user_id) | null                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public     | workspaces       | Users can view own workspaces              | PERMISSIVE | {public} | SELECT | (auth.uid() = user_id) | null                                                                                                                                                                                                                                                                                                                                                                                                                             |

| trigger_schema | trigger_name                        | event_object_table | action_timing | event_manipulation | action_statement                                       |
| -------------- | ----------------------------------- | ------------------ | ------------- | ------------------ | ------------------------------------------------------ |
| auth           | on_new_user                         | users              | AFTER         | INSERT             | EXECUTE FUNCTION handle_new_user()                     |
| public         | validate_ranking_references_trigger | keyword_rankings   | BEFORE        | UPDATE             | EXECUTE FUNCTION validate_ranking_references()         |
| public         | validate_ranking_references_trigger | keyword_rankings   | BEFORE        | INSERT             | EXECUTE FUNCTION validate_ranking_references()         |
| public         | update_keywords_updated_at          | keywords           | BEFORE        | UPDATE             | EXECUTE FUNCTION update_updated_at_column()            |
| public         | validate_keyword_references_trigger | keywords           | BEFORE        | INSERT             | EXECUTE FUNCTION validate_keyword_references()         |
| public         | validate_keyword_references_trigger | keywords           | BEFORE        | UPDATE             | EXECUTE FUNCTION validate_keyword_references()         |
| public         | update_sites_updated_at             | sites              | BEFORE        | UPDATE             | EXECUTE FUNCTION update_updated_at_column()            |
| public         | update_user_profiles_updated_at     | user_profiles      | BEFORE        | UPDATE             | EXECUTE FUNCTION update_updated_at_column()            |
| public         | update_workspaces_updated_at        | workspaces         | BEFORE        | UPDATE             | EXECUTE FUNCTION update_updated_at_column()            |
| realtime       | tr_check_filters                    | subscription       | BEFORE        | INSERT             | EXECUTE FUNCTION realtime.subscription_check_filters() |
| realtime       | tr_check_filters                    | subscription       | BEFORE        | UPDATE             | EXECUTE FUNCTION realtime.subscription_check_filters() |
| storage        | update_objects_updated_at           | objects            | BEFORE        | UPDATE             | EXECUTE FUNCTION storage.update_updated_at_column()    |

| routine_schema | routine_name                          | routine_type | data_type                | routine_definition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| -------------- | ------------------------------------- | ------------ | ------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| auth           | email                                 | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| auth           | jwt                                   | FUNCTION     | jsonb                    | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| auth           | role                                  | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| auth           | uid                                   | FUNCTION     | uuid                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | armor                                 | FUNCTION     | text                     | pg_armor                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| extensions     | armor                                 | FUNCTION     | text                     | pg_armor                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| extensions     | crypt                                 | FUNCTION     | text                     | pg_crypt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| extensions     | dearmor                               | FUNCTION     | bytea                    | pg_dearmor                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| extensions     | decrypt                               | FUNCTION     | bytea                    | pg_decrypt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| extensions     | decrypt_iv                            | FUNCTION     | bytea                    | pg_decrypt_iv                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| extensions     | digest                                | FUNCTION     | bytea                    | pg_digest                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| extensions     | digest                                | FUNCTION     | bytea                    | pg_digest                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| extensions     | encrypt                               | FUNCTION     | bytea                    | pg_encrypt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| extensions     | encrypt_iv                            | FUNCTION     | bytea                    | pg_encrypt_iv                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| extensions     | gen_random_bytes                      | FUNCTION     | bytea                    | pg_random_bytes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| extensions     | gen_random_uuid                       | FUNCTION     | uuid                     | pg_random_uuid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| extensions     | gen_salt                              | FUNCTION     | text                     | pg_gen_salt_rounds                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| extensions     | gen_salt                              | FUNCTION     | text                     | pg_gen_salt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| extensions     | grant_pg_cron_access                  | FUNCTION     | event_trigger            | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | grant_pg_graphql_access               | FUNCTION     | event_trigger            | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | grant_pg_net_access                   | FUNCTION     | event_trigger            | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | hmac                                  | FUNCTION     | bytea                    | pg_hmac                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| extensions     | hmac                                  | FUNCTION     | bytea                    | pg_hmac                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| extensions     | pg_stat_statements                    | FUNCTION     | record                   | pg_stat_statements_1_11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| extensions     | pg_stat_statements_info               | FUNCTION     | record                   | pg_stat_statements_info                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| extensions     | pg_stat_statements_reset              | FUNCTION     | timestamp with time zone | pg_stat_statements_reset_1_11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| extensions     | pgp_armor_headers                     | FUNCTION     | record                   | pgp_armor_headers                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| extensions     | pgp_key_id                            | FUNCTION     | text                     | pgp_key_id_w                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| extensions     | pgp_pub_decrypt                       | FUNCTION     | text                     | pgp_pub_decrypt_text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | pgp_pub_decrypt                       | FUNCTION     | text                     | pgp_pub_decrypt_text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | pgp_pub_decrypt                       | FUNCTION     | text                     | pgp_pub_decrypt_text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | pgp_pub_decrypt_bytea                 | FUNCTION     | bytea                    | pgp_pub_decrypt_bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| extensions     | pgp_pub_decrypt_bytea                 | FUNCTION     | bytea                    | pgp_pub_decrypt_bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| extensions     | pgp_pub_decrypt_bytea                 | FUNCTION     | bytea                    | pgp_pub_decrypt_bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| extensions     | pgp_pub_encrypt                       | FUNCTION     | bytea                    | pgp_pub_encrypt_text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | pgp_pub_encrypt                       | FUNCTION     | bytea                    | pgp_pub_encrypt_text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | pgp_pub_encrypt_bytea                 | FUNCTION     | bytea                    | pgp_pub_encrypt_bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| extensions     | pgp_pub_encrypt_bytea                 | FUNCTION     | bytea                    | pgp_pub_encrypt_bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| extensions     | pgp_sym_decrypt                       | FUNCTION     | text                     | pgp_sym_decrypt_text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | pgp_sym_decrypt                       | FUNCTION     | text                     | pgp_sym_decrypt_text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | pgp_sym_decrypt_bytea                 | FUNCTION     | bytea                    | pgp_sym_decrypt_bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| extensions     | pgp_sym_decrypt_bytea                 | FUNCTION     | bytea                    | pgp_sym_decrypt_bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| extensions     | pgp_sym_encrypt                       | FUNCTION     | bytea                    | pgp_sym_encrypt_text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | pgp_sym_encrypt                       | FUNCTION     | bytea                    | pgp_sym_encrypt_text                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | pgp_sym_encrypt_bytea                 | FUNCTION     | bytea                    | pgp_sym_encrypt_bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| extensions     | pgp_sym_encrypt_bytea                 | FUNCTION     | bytea                    | pgp_sym_encrypt_bytea                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| extensions     | pgrst_ddl_watch                       | FUNCTION     | event_trigger            | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | pgrst_drop_watch                      | FUNCTION     | event_trigger            | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | set_graphql_placeholder               | FUNCTION     | event_trigger            | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| extensions     | uuid_generate_v1                      | FUNCTION     | uuid                     | uuid_generate_v1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| extensions     | uuid_generate_v1mc                    | FUNCTION     | uuid                     | uuid_generate_v1mc                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| extensions     | uuid_generate_v3                      | FUNCTION     | uuid                     | uuid_generate_v3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| extensions     | uuid_generate_v4                      | FUNCTION     | uuid                     | uuid_generate_v4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| extensions     | uuid_generate_v5                      | FUNCTION     | uuid                     | uuid_generate_v5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| extensions     | uuid_nil                              | FUNCTION     | uuid                     | uuid_nil                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| extensions     | uuid_ns_dns                           | FUNCTION     | uuid                     | uuid_ns_dns                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| extensions     | uuid_ns_oid                           | FUNCTION     | uuid                     | uuid_ns_oid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| extensions     | uuid_ns_url                           | FUNCTION     | uuid                     | uuid_ns_url                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| extensions     | uuid_ns_x500                          | FUNCTION     | uuid                     | uuid_ns_x500                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| graphql        | _internal_resolve                     | FUNCTION     | jsonb                    | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| graphql        | comment_directive                     | FUNCTION     | jsonb                    | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| graphql        | exception                             | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| graphql        | get_schema_version                    | FUNCTION     | integer                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| graphql        | increment_schema_version              | FUNCTION     | event_trigger            | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| graphql        | resolve                               | FUNCTION     | jsonb                    | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| graphql_public | graphql                               | FUNCTION     | jsonb                    | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| pgbouncer      | get_auth                              | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public         | generate_sample_positions             | FUNCTION     | void                     | 
DECLARE
    keyword_record RECORD;
    i INTEGER;
    base_date DATE;
BEGIN
    base_date := CURRENT_DATE - INTERVAL '30 days';
    
    FOR keyword_record IN SELECT id FROM keywords LOOP
        FOR i IN 0..29 LOOP
            INSERT INTO keyword_positions (keyword_id, position, url, traffic, date)
            VALUES (
                keyword_record.id,
                FLOOR(RANDOM() * 100) + 1, -- Random position 1-100
                '/sample-url',
                FLOOR(RANDOM() * 50) + 1, -- Random traffic 1-50
                base_date + (i || ' days')::INTERVAL
            );
        END LOOP;
    END LOOP;
END;
 |
| public         | handle_new_user                       | FUNCTION     | trigger                  | 
begin
  insert into user_profiles (id, full_name)
  values (new.id, new.raw_user_meta_data ->> 'full_name');
  return new;
end;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public         | update_updated_at_column              | FUNCTION     | trigger                  | 
BEGIN
    NEW.updated_at = now();
    RETURN NEW;
END;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| public         | validate_keyword_references           | FUNCTION     | trigger                  | 
DECLARE
    site_workspace_id UUID;
    site_user_id UUID;
BEGIN
    -- Get the workspace_id and user_id from the site
    SELECT workspace_id, user_id INTO site_workspace_id, site_user_id
    FROM sites 
    WHERE id = NEW.site_id;
    
    -- Ensure the workspace_id and user_id match
    IF site_workspace_id != NEW.workspace_id OR site_user_id != NEW.user_id THEN
        RAISE EXCEPTION 'Keyword references do not match site ownership';
    END IF;
    
    RETURN NEW;
END;
                                                                                                                                  |
| public         | validate_ranking_references           | FUNCTION     | trigger                  | 
DECLARE
    keyword_site_id UUID;
    keyword_workspace_id UUID;
    keyword_user_id UUID;
BEGIN
    -- Get references from the keyword
    SELECT site_id, workspace_id, user_id 
    INTO keyword_site_id, keyword_workspace_id, keyword_user_id
    FROM keywords 
    WHERE id = NEW.keyword_id;
    
    -- Ensure all references match
    IF keyword_site_id != NEW.site_id OR 
       keyword_workspace_id != NEW.workspace_id OR 
       keyword_user_id != NEW.user_id THEN
        RAISE EXCEPTION 'Ranking references do not match keyword ownership';
    END IF;
    
    RETURN NEW;
END;
                     |
| realtime       | apply_rls                             | FUNCTION     | USER-DEFINED             | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| realtime       | broadcast_changes                     | FUNCTION     | void                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| realtime       | build_prepared_statement_sql          | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| realtime       | cast                                  | FUNCTION     | jsonb                    | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| realtime       | check_equality_op                     | FUNCTION     | boolean                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| realtime       | is_visible_through_filters            | FUNCTION     | boolean                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| realtime       | list_changes                          | FUNCTION     | USER-DEFINED             | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| realtime       | quote_wal2json                        | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| realtime       | send                                  | FUNCTION     | void                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| realtime       | subscription_check_filters            | FUNCTION     | trigger                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| realtime       | to_regrole                            | FUNCTION     | regrole                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| realtime       | topic                                 | FUNCTION     | text                     | 
select nullif(current_setting('realtime.topic', true), '')::text;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| storage        | can_insert_object                     | FUNCTION     | void                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| storage        | extension                             | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| storage        | filename                              | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| storage        | foldername                            | FUNCTION     | ARRAY                    | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| storage        | get_size_by_bucket                    | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| storage        | list_multipart_uploads_with_delimiter | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| storage        | list_objects_with_delimiter           | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| storage        | operation                             | FUNCTION     | text                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| storage        | search                                | FUNCTION     | record                   | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| storage        | update_updated_at_column              | FUNCTION     | trigger                  | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| vault          | _crypto_aead_det_decrypt              | FUNCTION     | bytea                    | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| vault          | create_secret                         | FUNCTION     | uuid                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| vault          | update_secret                         | FUNCTION     | void                     | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

| table_name        | table_type |
| ----------------- | ---------- |
| audit_log_entries | BASE TABLE |
| flow_state        | BASE TABLE |
| identities        | BASE TABLE |
| instances         | BASE TABLE |
| mfa_amr_claims    | BASE TABLE |
| mfa_challenges    | BASE TABLE |
| mfa_factors       | BASE TABLE |
| one_time_tokens   | BASE TABLE |
| refresh_tokens    | BASE TABLE |
| saml_providers    | BASE TABLE |
| saml_relay_states | BASE TABLE |
| schema_migrations | BASE TABLE |
| sessions          | BASE TABLE |
| sso_domains       | BASE TABLE |
| sso_providers     | BASE TABLE |
| users             | BASE TABLE |

| constraint_name                                             | table_schema | table_name                 | constraint_type | column_name           | foreign_table_schema | foreign_table_name | foreign_column_name |
| ----------------------------------------------------------- | ------------ | -------------------------- | --------------- | --------------------- | -------------------- | ------------------ | ------------------- |
| 16492_16523_2_not_null                                      | auth         | audit_log_entries          | CHECK           | null                  | null                 | null               | null                |
| 16492_16523_5_not_null                                      | auth         | audit_log_entries          | CHECK           | null                  | null                 | null               | null                |
| audit_log_entries_pkey                                      | auth         | audit_log_entries          | PRIMARY KEY     | id                    | null                 | null               | null                |
| 16492_16925_11_not_null                                     | auth         | flow_state                 | CHECK           | null                  | null                 | null               | null                |
| 16492_16925_1_not_null                                      | auth         | flow_state                 | CHECK           | null                  | null                 | null               | null                |
| 16492_16925_3_not_null                                      | auth         | flow_state                 | CHECK           | null                  | null                 | null               | null                |
| 16492_16925_4_not_null                                      | auth         | flow_state                 | CHECK           | null                  | null                 | null               | null                |
| 16492_16925_5_not_null                                      | auth         | flow_state                 | CHECK           | null                  | null                 | null               | null                |
| 16492_16925_6_not_null                                      | auth         | flow_state                 | CHECK           | null                  | null                 | null               | null                |
| flow_state_pkey                                             | auth         | flow_state                 | PRIMARY KEY     | id                    | null                 | null               | null                |
| 16492_16723_1_not_null                                      | auth         | identities                 | CHECK           | null                  | null                 | null               | null                |
| 16492_16723_2_not_null                                      | auth         | identities                 | CHECK           | null                  | null                 | null               | null                |
| 16492_16723_3_not_null                                      | auth         | identities                 | CHECK           | null                  | null                 | null               | null                |
| 16492_16723_4_not_null                                      | auth         | identities                 | CHECK           | null                  | null                 | null               | null                |
| 16492_16723_9_not_null                                      | auth         | identities                 | CHECK           | null                  | null                 | null               | null                |
| identities_pkey                                             | auth         | identities                 | PRIMARY KEY     | id                    | null                 | null               | null                |
| identities_provider_id_provider_unique                      | auth         | identities                 | UNIQUE          | provider_id           | null                 | null               | null                |
| identities_provider_id_provider_unique                      | auth         | identities                 | UNIQUE          | provider              | null                 | null               | null                |
| identities_user_id_fkey                                     | auth         | identities                 | FOREIGN KEY     | user_id               | null                 | null               | null                |
| 16492_16516_1_not_null                                      | auth         | instances                  | CHECK           | null                  | null                 | null               | null                |
| instances_pkey                                              | auth         | instances                  | PRIMARY KEY     | id                    | null                 | null               | null                |
| 16492_16812_1_not_null                                      | auth         | mfa_amr_claims             | CHECK           | null                  | null                 | null               | null                |
| 16492_16812_2_not_null                                      | auth         | mfa_amr_claims             | CHECK           | null                  | null                 | null               | null                |
| 16492_16812_3_not_null                                      | auth         | mfa_amr_claims             | CHECK           | null                  | null                 | null               | null                |
| 16492_16812_4_not_null                                      | auth         | mfa_amr_claims             | CHECK           | null                  | null                 | null               | null                |
| 16492_16812_5_not_null                                      | auth         | mfa_amr_claims             | CHECK           | null                  | null                 | null               | null                |
| amr_id_pk                                                   | auth         | mfa_amr_claims             | PRIMARY KEY     | id                    | null                 | null               | null                |
| mfa_amr_claims_session_id_authentication_method_pkey        | auth         | mfa_amr_claims             | UNIQUE          | authentication_method | null                 | null               | null                |
| mfa_amr_claims_session_id_authentication_method_pkey        | auth         | mfa_amr_claims             | UNIQUE          | session_id            | null                 | null               | null                |
| mfa_amr_claims_session_id_fkey                              | auth         | mfa_amr_claims             | FOREIGN KEY     | session_id            | null                 | null               | null                |
| 16492_16800_1_not_null                                      | auth         | mfa_challenges             | CHECK           | null                  | null                 | null               | null                |
| 16492_16800_2_not_null                                      | auth         | mfa_challenges             | CHECK           | null                  | null                 | null               | null                |
| 16492_16800_3_not_null                                      | auth         | mfa_challenges             | CHECK           | null                  | null                 | null               | null                |
| 16492_16800_5_not_null                                      | auth         | mfa_challenges             | CHECK           | null                  | null                 | null               | null                |
| mfa_challenges_auth_factor_id_fkey                          | auth         | mfa_challenges             | FOREIGN KEY     | factor_id             | null                 | null               | null                |
| mfa_challenges_pkey                                         | auth         | mfa_challenges             | PRIMARY KEY     | id                    | null                 | null               | null                |
| 16492_16787_1_not_null                                      | auth         | mfa_factors                | CHECK           | null                  | null                 | null               | null                |
| 16492_16787_2_not_null                                      | auth         | mfa_factors                | CHECK           | null                  | null                 | null               | null                |
| 16492_16787_4_not_null                                      | auth         | mfa_factors                | CHECK           | null                  | null                 | null               | null                |
| 16492_16787_5_not_null                                      | auth         | mfa_factors                | CHECK           | null                  | null                 | null               | null                |
| 16492_16787_6_not_null                                      | auth         | mfa_factors                | CHECK           | null                  | null                 | null               | null                |
| 16492_16787_7_not_null                                      | auth         | mfa_factors                | CHECK           | null                  | null                 | null               | null                |
| mfa_factors_last_challenged_at_key                          | auth         | mfa_factors                | UNIQUE          | last_challenged_at    | null                 | null               | null                |
| mfa_factors_pkey                                            | auth         | mfa_factors                | PRIMARY KEY     | id                    | null                 | null               | null                |
| mfa_factors_user_id_fkey                                    | auth         | mfa_factors                | FOREIGN KEY     | user_id               | null                 | null               | null                |
| 16492_16975_1_not_null                                      | auth         | one_time_tokens            | CHECK           | null                  | null                 | null               | null                |
| 16492_16975_2_not_null                                      | auth         | one_time_tokens            | CHECK           | null                  | null                 | null               | null                |
| 16492_16975_3_not_null                                      | auth         | one_time_tokens            | CHECK           | null                  | null                 | null               | null                |
| 16492_16975_4_not_null                                      | auth         | one_time_tokens            | CHECK           | null                  | null                 | null               | null                |
| 16492_16975_5_not_null                                      | auth         | one_time_tokens            | CHECK           | null                  | null                 | null               | null                |
| 16492_16975_6_not_null                                      | auth         | one_time_tokens            | CHECK           | null                  | null                 | null               | null                |
| 16492_16975_7_not_null                                      | auth         | one_time_tokens            | CHECK           | null                  | null                 | null               | null                |
| one_time_tokens_pkey                                        | auth         | one_time_tokens            | PRIMARY KEY     | id                    | null                 | null               | null                |
| one_time_tokens_token_hash_check                            | auth         | one_time_tokens            | CHECK           | null                  | null                 | null               | null                |
| one_time_tokens_user_id_fkey                                | auth         | one_time_tokens            | FOREIGN KEY     | user_id               | null                 | null               | null                |
| 16492_16505_2_not_null                                      | auth         | refresh_tokens             | CHECK           | null                  | null                 | null               | null                |
| refresh_tokens_pkey                                         | auth         | refresh_tokens             | PRIMARY KEY     | id                    | null                 | null               | null                |
| refresh_tokens_session_id_fkey                              | auth         | refresh_tokens             | FOREIGN KEY     | session_id            | null                 | null               | null                |
| refresh_tokens_token_unique                                 | auth         | refresh_tokens             | UNIQUE          | token                 | null                 | null               | null                |
| 16492_16854_1_not_null                                      | auth         | saml_providers             | CHECK           | null                  | null                 | null               | null                |
| 16492_16854_2_not_null                                      | auth         | saml_providers             | CHECK           | null                  | null                 | null               | null                |
| 16492_16854_3_not_null                                      | auth         | saml_providers             | CHECK           | null                  | null                 | null               | null                |
| 16492_16854_4_not_null                                      | auth         | saml_providers             | CHECK           | null                  | null                 | null               | null                |
| entity_id not empty                                         | auth         | saml_providers             | CHECK           | null                  | null                 | null               | null                |
| metadata_url not empty                                      | auth         | saml_providers             | CHECK           | null                  | null                 | null               | null                |
| metadata_xml not empty                                      | auth         | saml_providers             | CHECK           | null                  | null                 | null               | null                |
| saml_providers_entity_id_key                                | auth         | saml_providers             | UNIQUE          | entity_id             | null                 | null               | null                |
| saml_providers_pkey                                         | auth         | saml_providers             | PRIMARY KEY     | id                    | null                 | null               | null                |
| saml_providers_sso_provider_id_fkey                         | auth         | saml_providers             | FOREIGN KEY     | sso_provider_id       | null                 | null               | null                |
| 16492_16872_1_not_null                                      | auth         | saml_relay_states          | CHECK           | null                  | null                 | null               | null                |
| 16492_16872_2_not_null                                      | auth         | saml_relay_states          | CHECK           | null                  | null                 | null               | null                |
| 16492_16872_3_not_null                                      | auth         | saml_relay_states          | CHECK           | null                  | null                 | null               | null                |
| request_id not empty                                        | auth         | saml_relay_states          | CHECK           | null                  | null                 | null               | null                |
| saml_relay_states_flow_state_id_fkey                        | auth         | saml_relay_states          | FOREIGN KEY     | flow_state_id         | null                 | null               | null                |
| saml_relay_states_pkey                                      | auth         | saml_relay_states          | PRIMARY KEY     | id                    | null                 | null               | null                |
| saml_relay_states_sso_provider_id_fkey                      | auth         | saml_relay_states          | FOREIGN KEY     | sso_provider_id       | null                 | null               | null                |
| 16492_16753_1_not_null                                      | auth         | sessions                   | CHECK           | null                  | null                 | null               | null                |
| 16492_16753_2_not_null                                      | auth         | sessions                   | CHECK           | null                  | null                 | null               | null                |
| sessions_pkey                                               | auth         | sessions                   | PRIMARY KEY     | id                    | null                 | null               | null                |
| sessions_user_id_fkey                                       | auth         | sessions                   | FOREIGN KEY     | user_id               | null                 | null               | null                |
| 16492_16839_1_not_null                                      | auth         | sso_domains                | CHECK           | null                  | null                 | null               | null                |
| 16492_16839_2_not_null                                      | auth         | sso_domains                | CHECK           | null                  | null                 | null               | null                |
| 16492_16839_3_not_null                                      | auth         | sso_domains                | CHECK           | null                  | null                 | null               | null                |
| domain not empty                                            | auth         | sso_domains                | CHECK           | null                  | null                 | null               | null                |
| sso_domains_pkey                                            | auth         | sso_domains                | PRIMARY KEY     | id                    | null                 | null               | null                |
| sso_domains_sso_provider_id_fkey                            | auth         | sso_domains                | FOREIGN KEY     | sso_provider_id       | null                 | null               | null                |
| 16492_16830_1_not_null                                      | auth         | sso_providers              | CHECK           | null                  | null                 | null               | null                |
| resource_id not empty                                       | auth         | sso_providers              | CHECK           | null                  | null                 | null               | null                |
| sso_providers_pkey                                          | auth         | sso_providers              | PRIMARY KEY     | id                    | null                 | null               | null                |
| 16492_16493_2_not_null                                      | auth         | users                      | CHECK           | null                  | null                 | null               | null                |
| 16492_16493_33_not_null                                     | auth         | users                      | CHECK           | null                  | null                 | null               | null                |
| 16492_16493_35_not_null                                     | auth         | users                      | CHECK           | null                  | null                 | null               | null                |
| users_email_change_confirm_status_check                     | auth         | users                      | CHECK           | null                  | null                 | null               | null                |
| users_phone_key                                             | auth         | users                      | UNIQUE          | phone                 | null                 | null               | null                |
| users_pkey                                                  | auth         | users                      | PRIMARY KEY     | id                    | null                 | null               | null                |
| 2200_19161_10_not_null                                      | public       | keyword_rankings           | CHECK           | null                  | null                 | null               | null                |
| 2200_19161_1_not_null                                       | public       | keyword_rankings           | CHECK           | null                  | null                 | null               | null                |
| 2200_19161_2_not_null                                       | public       | keyword_rankings           | CHECK           | null                  | null                 | null               | null                |
| 2200_19161_3_not_null                                       | public       | keyword_rankings           | CHECK           | null                  | null                 | null               | null                |
| 2200_19161_4_not_null                                       | public       | keyword_rankings           | CHECK           | null                  | null                 | null               | null                |
| 2200_19161_5_not_null                                       | public       | keyword_rankings           | CHECK           | null                  | null                 | null               | null                |
| 2200_19161_7_not_null                                       | public       | keyword_rankings           | CHECK           | null                  | null                 | null               | null                |
| 2200_19161_8_not_null                                       | public       | keyword_rankings           | CHECK           | null                  | null                 | null               | null                |
| 2200_19161_9_not_null                                       | public       | keyword_rankings           | CHECK           | null                  | null                 | null               | null                |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | location              | public               | keyword_rankings   | keyword_id          |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | location              | public               | keyword_rankings   | location            |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | location              | public               | keyword_rankings   | recorded_at         |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | device                | public               | keyword_rankings   | device              |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | device                | public               | keyword_rankings   | keyword_id          |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | device                | public               | keyword_rankings   | location            |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | device                | public               | keyword_rankings   | recorded_at         |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | keyword_id            | public               | keyword_rankings   | device              |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | keyword_id            | public               | keyword_rankings   | keyword_id          |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | keyword_id            | public               | keyword_rankings   | location            |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | keyword_id            | public               | keyword_rankings   | recorded_at         |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | location              | public               | keyword_rankings   | device              |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | recorded_at           | public               | keyword_rankings   | recorded_at         |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | recorded_at           | public               | keyword_rankings   | device              |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | recorded_at           | public               | keyword_rankings   | keyword_id          |
| keyword_rankings_keyword_id_device_location_recorded_at_key | public       | keyword_rankings           | UNIQUE          | recorded_at           | public               | keyword_rankings   | location            |
| keyword_rankings_keyword_id_fkey                            | public       | keyword_rankings           | FOREIGN KEY     | keyword_id            | public               | keywords           | id                  |
| keyword_rankings_pkey                                       | public       | keyword_rankings           | PRIMARY KEY     | id                    | public               | keyword_rankings   | id                  |
| keyword_rankings_position_check                             | public       | keyword_rankings           | CHECK           | null                  | public               | keyword_rankings   | position            |
| keyword_rankings_site_id_fkey                               | public       | keyword_rankings           | FOREIGN KEY     | site_id               | public               | sites              | id                  |
| keyword_rankings_user_id_fkey                               | public       | keyword_rankings           | FOREIGN KEY     | user_id               | null                 | null               | null                |
| keyword_rankings_workspace_id_fkey                          | public       | keyword_rankings           | FOREIGN KEY     | workspace_id          | public               | workspaces         | id                  |
| 2200_19132_1_not_null                                       | public       | keywords                   | CHECK           | null                  | null                 | null               | null                |
| 2200_19132_2_not_null                                       | public       | keywords                   | CHECK           | null                  | null                 | null               | null                |
| 2200_19132_3_not_null                                       | public       | keywords                   | CHECK           | null                  | null                 | null               | null                |
| 2200_19132_4_not_null                                       | public       | keywords                   | CHECK           | null                  | null                 | null               | null                |
| 2200_19132_5_not_null                                       | public       | keywords                   | CHECK           | null                  | null                 | null               | null                |
| 2200_19132_8_not_null                                       | public       | keywords                   | CHECK           | null                  | null                 | null               | null                |
| 2200_19132_9_not_null                                       | public       | keywords                   | CHECK           | null                  | null                 | null               | null                |
| keyword_length                                              | public       | keywords                   | CHECK           | null                  | public               | keywords           | keyword             |
| keywords_pkey                                               | public       | keywords                   | PRIMARY KEY     | id                    | public               | keywords           | id                  |
| keywords_site_id_fkey                                       | public       | keywords                   | FOREIGN KEY     | site_id               | public               | sites              | id                  |
| keywords_site_id_keyword_key                                | public       | keywords                   | UNIQUE          | keyword               | public               | keywords           | site_id             |
| keywords_site_id_keyword_key                                | public       | keywords                   | UNIQUE          | site_id               | public               | keywords           | site_id             |
| keywords_site_id_keyword_key                                | public       | keywords                   | UNIQUE          | keyword               | public               | keywords           | keyword             |
| keywords_site_id_keyword_key                                | public       | keywords                   | UNIQUE          | site_id               | public               | keywords           | keyword             |
| keywords_user_id_fkey                                       | public       | keywords                   | FOREIGN KEY     | user_id               | null                 | null               | null                |
| keywords_volume_check                                       | public       | keywords                   | CHECK           | null                  | public               | keywords           | volume              |
| keywords_workspace_id_fkey                                  | public       | keywords                   | FOREIGN KEY     | workspace_id          | public               | workspaces         | id                  |
| 2200_19107_1_not_null                                       | public       | sites                      | CHECK           | null                  | null                 | null               | null                |
| 2200_19107_2_not_null                                       | public       | sites                      | CHECK           | null                  | null                 | null               | null                |
| 2200_19107_3_not_null                                       | public       | sites                      | CHECK           | null                  | null                 | null               | null                |
| 2200_19107_4_not_null                                       | public       | sites                      | CHECK           | null                  | null                 | null               | null                |
| 2200_19107_5_not_null                                       | public       | sites                      | CHECK           | null                  | null                 | null               | null                |
| 2200_19107_6_not_null                                       | public       | sites                      | CHECK           | null                  | null                 | null               | null                |
| 2200_19107_7_not_null                                       | public       | sites                      | CHECK           | null                  | null                 | null               | null                |
| 2200_19107_8_not_null                                       | public       | sites                      | CHECK           | null                  | null                 | null               | null                |
| site_domain_format                                          | public       | sites                      | CHECK           | null                  | public               | sites              | domain              |
| site_name_length                                            | public       | sites                      | CHECK           | null                  | public               | sites              | name                |
| sites_pkey                                                  | public       | sites                      | PRIMARY KEY     | id                    | public               | sites              | id                  |
| sites_user_id_fkey                                          | public       | sites                      | FOREIGN KEY     | user_id               | null                 | null               | null                |
| sites_workspace_id_domain_key                               | public       | sites                      | UNIQUE          | workspace_id          | public               | sites              | workspace_id        |
| sites_workspace_id_domain_key                               | public       | sites                      | UNIQUE          | domain                | public               | sites              | domain              |
| sites_workspace_id_domain_key                               | public       | sites                      | UNIQUE          | domain                | public               | sites              | workspace_id        |
| sites_workspace_id_domain_key                               | public       | sites                      | UNIQUE          | workspace_id          | public               | sites              | domain              |
| sites_workspace_id_fkey                                     | public       | sites                      | FOREIGN KEY     | workspace_id          | public               | workspaces         | id                  |
| 2200_19073_1_not_null                                       | public       | user_profiles              | CHECK           | null                  | null                 | null               | null                |
| 2200_19073_2_not_null                                       | public       | user_profiles              | CHECK           | null                  | null                 | null               | null                |
| 2200_19073_5_not_null                                       | public       | user_profiles              | CHECK           | null                  | null                 | null               | null                |
| 2200_19073_6_not_null                                       | public       | user_profiles              | CHECK           | null                  | null                 | null               | null                |
| 2200_19073_7_not_null                                       | public       | user_profiles              | CHECK           | null                  | null                 | null               | null                |
| user_profiles_pkey                                          | public       | user_profiles              | PRIMARY KEY     | id                    | public               | user_profiles      | id                  |
| user_profiles_user_id_key                                   | public       | user_profiles              | UNIQUE          | user_id               | public               | user_profiles      | user_id             |
| 2200_19091_1_not_null                                       | public       | workspaces                 | CHECK           | null                  | null                 | null               | null                |
| 2200_19091_2_not_null                                       | public       | workspaces                 | CHECK           | null                  | null                 | null               | null                |
| 2200_19091_3_not_null                                       | public       | workspaces                 | CHECK           | null                  | null                 | null               | null                |
| 2200_19091_5_not_null                                       | public       | workspaces                 | CHECK           | null                  | null                 | null               | null                |
| 2200_19091_6_not_null                                       | public       | workspaces                 | CHECK           | null                  | null                 | null               | null                |
| workspace_name_length                                       | public       | workspaces                 | CHECK           | null                  | public               | workspaces         | name                |
| workspaces_pkey                                             | public       | workspaces                 | PRIMARY KEY     | id                    | public               | workspaces         | id                  |
| workspaces_user_id_fkey                                     | public       | workspaces                 | FOREIGN KEY     | user_id               | null                 | null               | null                |
| 16603_17251_10_not_null                                     | realtime     | messages                   | CHECK           | null                  | null                 | null               | null                |
| 16603_17251_3_not_null                                      | realtime     | messages                   | CHECK           | null                  | null                 | null               | null                |
| 16603_17251_4_not_null                                      | realtime     | messages                   | CHECK           | null                  | null                 | null               | null                |
| 16603_17251_8_not_null                                      | realtime     | messages                   | CHECK           | null                  | null                 | null               | null                |
| 16603_17251_9_not_null                                      | realtime     | messages                   | CHECK           | null                  | null                 | null               | null                |
| messages_pkey                                               | realtime     | messages                   | PRIMARY KEY     | inserted_at           | realtime             | messages           | id                  |
| messages_pkey                                               | realtime     | messages                   | PRIMARY KEY     | id                    | realtime             | messages           | inserted_at         |
| messages_pkey                                               | realtime     | messages                   | PRIMARY KEY     | id                    | realtime             | messages           | id                  |
| messages_pkey                                               | realtime     | messages                   | PRIMARY KEY     | inserted_at           | realtime             | messages           | inserted_at         |
| 16603_17089_1_not_null                                      | realtime     | schema_migrations          | CHECK           | null                  | null                 | null               | null                |
| schema_migrations_pkey                                      | realtime     | schema_migrations          | PRIMARY KEY     | version               | null                 | null               | null                |
| 16603_17111_1_not_null                                      | realtime     | subscription               | CHECK           | null                  | null                 | null               | null                |
| 16603_17111_2_not_null                                      | realtime     | subscription               | CHECK           | null                  | null                 | null               | null                |
| 16603_17111_4_not_null                                      | realtime     | subscription               | CHECK           | null                  | null                 | null               | null                |
| 16603_17111_5_not_null                                      | realtime     | subscription               | CHECK           | null                  | null                 | null               | null                |
| 16603_17111_7_not_null                                      | realtime     | subscription               | CHECK           | null                  | null                 | null               | null                |
| 16603_17111_8_not_null                                      | realtime     | subscription               | CHECK           | null                  | null                 | null               | null                |
| 16603_17111_9_not_null                                      | realtime     | subscription               | CHECK           | null                  | null                 | null               | null                |
| pk_subscription                                             | realtime     | subscription               | PRIMARY KEY     | id                    | null                 | null               | null                |
| 16540_16544_1_not_null                                      | storage      | buckets                    | CHECK           | null                  | null                 | null               | null                |
| 16540_16544_2_not_null                                      | storage      | buckets                    | CHECK           | null                  | null                 | null               | null                |
| buckets_pkey                                                | storage      | buckets                    | PRIMARY KEY     | id                    | null                 | null               | null                |
| 16540_16559_1_not_null                                      | storage      | objects                    | CHECK           | null                  | null                 | null               | null                |
| objects_bucketId_fkey                                       | storage      | objects                    | FOREIGN KEY     | bucket_id             | null                 | null               | null                |
| objects_pkey                                                | storage      | objects                    | PRIMARY KEY     | id                    | null                 | null               | null                |
| 16540_17032_1_not_null                                      | storage      | s3_multipart_uploads       | CHECK           | null                  | null                 | null               | null                |
| 16540_17032_2_not_null                                      | storage      | s3_multipart_uploads       | CHECK           | null                  | null                 | null               | null                |
| 16540_17032_3_not_null                                      | storage      | s3_multipart_uploads       | CHECK           | null                  | null                 | null               | null                |
| 16540_17032_4_not_null                                      | storage      | s3_multipart_uploads       | CHECK           | null                  | null                 | null               | null                |
| 16540_17032_5_not_null                                      | storage      | s3_multipart_uploads       | CHECK           | null                  | null                 | null               | null                |
| 16540_17032_6_not_null                                      | storage      | s3_multipart_uploads       | CHECK           | null                  | null                 | null               | null                |
| 16540_17032_8_not_null                                      | storage      | s3_multipart_uploads       | CHECK           | null                  | null                 | null               | null                |
| s3_multipart_uploads_bucket_id_fkey                         | storage      | s3_multipart_uploads       | FOREIGN KEY     | bucket_id             | null                 | null               | null                |
| s3_multipart_uploads_pkey                                   | storage      | s3_multipart_uploads       | PRIMARY KEY     | id                    | null                 | null               | null                |
| 16540_17046_10_not_null                                     | storage      | s3_multipart_uploads_parts | CHECK           | null                  | null                 | null               | null                |
| 16540_17046_1_not_null                                      | storage      | s3_multipart_uploads_parts | CHECK           | null                  | null                 | null               | null                |
| 16540_17046_2_not_null                                      | storage      | s3_multipart_uploads_parts | CHECK           | null                  | null                 | null               | null                |
| 16540_17046_3_not_null                                      | storage      | s3_multipart_uploads_parts | CHECK           | null                  | null                 | null               | null                |
| 16540_17046_4_not_null                                      | storage      | s3_multipart_uploads_parts | CHECK           | null                  | null                 | null               | null                |
| 16540_17046_5_not_null                                      | storage      | s3_multipart_uploads_parts | CHECK           | null                  | null                 | null               | null                |
| 16540_17046_6_not_null                                      | storage      | s3_multipart_uploads_parts | CHECK           | null                  | null                 | null               | null                |
| 16540_17046_7_not_null                                      | storage      | s3_multipart_uploads_parts | CHECK           | null                  | null                 | null               | null                |
| 16540_17046_9_not_null                                      | storage      | s3_multipart_uploads_parts | CHECK           | null                  | null                 | null               | null                |
| s3_multipart_uploads_parts_bucket_id_fkey                   | storage      | s3_multipart_uploads_parts | FOREIGN KEY     | bucket_id             | null                 | null               | null                |
| s3_multipart_uploads_parts_pkey                             | storage      | s3_multipart_uploads_parts | PRIMARY KEY     | id                    | null                 | null               | null                |
| s3_multipart_uploads_parts_upload_id_fkey                   | storage      | s3_multipart_uploads_parts | FOREIGN KEY     | upload_id             | null                 | null               | null                |
| 16651_16656_1_not_null                                      | vault        | secrets                    | CHECK           | null                  | null                 | null               | null                |
| 16651_16656_3_not_null                                      | vault        | secrets                    | CHECK           | null                  | null                 | null               | null                |
| 16651_16656_4_not_null                                      | vault        | secrets                    | CHECK           | null                  | null                 | null               | null                |
| 16651_16656_7_not_null                                      | vault        | secrets                    | CHECK           | null                  | null                 | null               | null                |
| 16651_16656_8_not_null                                      | vault        | secrets                    | CHECK           | null                  | null                 | null               | null                |
| secrets_pkey                                                | vault        | secrets                    | PRIMARY KEY     | id                    | null                 | null               | null                |

| column_name  | data_type                | is_nullable | column_default    |
| ------------ | ------------------------ | ----------- | ----------------- |
| id           | uuid                     | NO          | gen_random_uuid() |
| user_id      | uuid                     | NO          | null              |
| avatar_url   | text                     | YES         | null              |
| plan         | USER-DEFINED             | NO          | 'free'::user_plan |
| created_at   | timestamp with time zone | NO          | now()             |
| updated_at   | timestamp with time zone | NO          | now()             |
| phone_number | text                     | YES         | null              |
| email        | text                     | YES         | null              |
| first_name   | text                     | YES         | null              |
| last_name    | text                     | YES         | null              |

| schemaname | tablename | rowsecurity | tableowner          |
| ---------- | --------- | ----------- | ------------------- |
| auth       | users     | true        | supabase_auth_admin |

| column_name                 | data_type                | is_nullable | column_default          |
| --------------------------- | ------------------------ | ----------- | ----------------------- |
| instance_id                 | uuid                     | YES         | null                    |
| id                          | uuid                     | NO          | null                    |
| aud                         | character varying        | YES         | null                    |
| role                        | character varying        | YES         | null                    |
| email                       | character varying        | YES         | null                    |
| encrypted_password          | character varying        | YES         | null                    |
| email_confirmed_at          | timestamp with time zone | YES         | null                    |
| invited_at                  | timestamp with time zone | YES         | null                    |
| confirmation_token          | character varying        | YES         | null                    |
| confirmation_sent_at        | timestamp with time zone | YES         | null                    |
| recovery_token              | character varying        | YES         | null                    |
| recovery_sent_at            | timestamp with time zone | YES         | null                    |
| email_change_token_new      | character varying        | YES         | null                    |
| email_change                | character varying        | YES         | null                    |
| email_change_sent_at        | timestamp with time zone | YES         | null                    |
| last_sign_in_at             | timestamp with time zone | YES         | null                    |
| raw_app_meta_data           | jsonb                    | YES         | null                    |
| raw_user_meta_data          | jsonb                    | YES         | null                    |
| is_super_admin              | boolean                  | YES         | null                    |
| created_at                  | timestamp with time zone | YES         | null                    |
| updated_at                  | timestamp with time zone | YES         | null                    |
| phone                       | text                     | YES         | NULL::character varying |
| phone_confirmed_at          | timestamp with time zone | YES         | null                    |
| phone_change                | text                     | YES         | ''::character varying   |
| phone_change_token          | character varying        | YES         | ''::character varying   |
| phone_change_sent_at        | timestamp with time zone | YES         | null                    |
| confirmed_at                | timestamp with time zone | YES         | null                    |
| email_change_token_current  | character varying        | YES         | ''::character varying   |
| email_change_confirm_status | smallint                 | YES         | 0                       |
| banned_until                | timestamp with time zone | YES         | null                    |
| reauthentication_token      | character varying        | YES         | ''::character varying   |
| reauthentication_sent_at    | timestamp with time zone | YES         | null                    |
| is_sso_user                 | boolean                  | NO          | false                   |
| deleted_at                  | timestamp with time zone | YES         | null                    |
| is_anonymous                | boolean                  | NO          | false                   |

| schemaname | tablename         | tableowner          | rowsecurity |
| ---------- | ----------------- | ------------------- | ----------- |
| auth       | audit_log_entries | supabase_auth_admin | true        |
| auth       | flow_state        | supabase_auth_admin | true        |
| auth       | identities        | supabase_auth_admin | true        |
| auth       | instances         | supabase_auth_admin | true        |
| auth       | mfa_amr_claims    | supabase_auth_admin | true        |
| auth       | mfa_challenges    | supabase_auth_admin | true        |
| auth       | mfa_factors       | supabase_auth_admin | true        |
| auth       | one_time_tokens   | supabase_auth_admin | true        |
| auth       | refresh_tokens    | supabase_auth_admin | true        |
| auth       | saml_providers    | supabase_auth_admin | true        |
| auth       | saml_relay_states | supabase_auth_admin | true        |
| auth       | schema_migrations | supabase_auth_admin | true        |
| auth       | sessions          | supabase_auth_admin | true        |
| auth       | sso_domains       | supabase_auth_admin | true        |
| auth       | sso_providers     | supabase_auth_admin | true        |
| auth       | users             | supabase_auth_admin | true        |
| public     | keyword_rankings  | postgres            | true        |
| public     | keywords          | postgres            | true        |
| public     | sites             | postgres            | true        |
| public     | user_profiles     | postgres            | true        |
| public     | workspaces        | postgres            | true        |

THEN YOU FUCKING ASK ME TO RUN RELATED TO RLS
-- FIX AUTHENTICATION RLS BLOCKING ISSUE
-- The problem: RLS policies block user creation because auth.uid() is NULL during signup

-- 1. TEMPORARILY DISABLE RLS ON USER_PROFILES TABLE
ALTER TABLE public.user_profiles DISABLE ROW LEVEL SECURITY;

-- 2. OR ALTERNATIVELY: Add a policy that allows service role to insert
-- DROP POLICY IF EXISTS "Users can insert own profile" ON public.user_profiles;
-- CREATE POLICY "Users can insert own profile" ON public.user_profiles
--   FOR INSERT WITH CHECK (
--     auth.uid() = user_id OR 
--     auth.jwt() ->> 'role' = 'service_role'
--   );

-- 3. CHECK CURRENT RLS STATUS
SELECT 
    schemaname,
    tablename,
    rowsecurity
FROM pg_tables
WHERE schemaname = 'public' 
AND tablename = 'user_profiles';

AND THIS:
Perfect! Now I can see exactly what's wrong. The issue is RLS policies blocking user creation. Looking at your diagnostic results:

RLS is enabled on all tables including user_profiles
user_profiles has RLS policy: "Users can insert own profile" with condition (auth.uid() = user_id)
The problem: When creating a new user, auth.uid() returns NULL because the user doesn't exist yet, so the RLS policy blocks the insert
Let me fix this immediately:


Created fix_auth_rls.sql

Opened attached_assets/Pasted--COMPLETE-SUPABASE-DIAGNOSTIC-QUERY-Run-this-in-your-Supabase-SQL-Editor-to-get-ALL-configurat-1754229866671_1754229866675.txt

Restarted Start application
I FOUND THE EXACT PROBLEM!

Looking at line 153 in your diagnostic results:

| auth           | on_new_user                         | users              | AFTER         | INSERT             | EXECUTE FUNCTION handle_new_user()                     |
THE ISSUE: There's a trigger on_new_user that calls handle_new_user() function every time a user is created in auth.users. This trigger is failing and causing the "Database error creating new user".

RUN THIS SQL IMMEDIATELY TO FIX IT:

-- Drop the broken trigger that's causing signup failures
DROP TRIGGER IF EXISTS on_new_user ON auth.users;
-- Also disable RLS on user_profiles temporarily to allow manual profile creation
ALTER TABLE public.user_profiles DISABLE ROW LEVEL SECURITY;

Executed curl -X POST http://localhost:5000/api/auth/signup -H "Content-Type: application/json" -d '{"email":"trigger@test.com","password":"TestPass123!","firstName":"Trigger","lastName":"Fixed","phoneNumber":"5551234567"}' -v
The trigger is still there! YOU MUST RUN THE SQL TO DROP THE TRIGGER:

DROP TRIGGER IF EXISTS on_new_user ON auth.users;
ALTER TABLE public.user_profiles DISABLE ROW LEVEL SECURITY;
The on_new_user trigger on auth.users table is executing handle_new_user() function every time someone signs up, and that function is failing. That's why you get "Database error creating new user".

RUN THOSE 2 SQL COMMANDS NOW - then signup will work immediately.

----
NOW, THE PROBLEM IS SOLVED, BUT NOT PERFECT. AFTER SIGN UP, WHEN IT'S REDIRECTED TO DASHBOARD, IT'S GLITCH TO LOGIN PAGE. SO WHICH ONE IS CORRECT AFTER USER SUCCESS SIGN UP? LOGIN OR DIRECTLY TO DASHBOARD?

IN AUTH MANAGEMENT SUPABASE, WHY THE DISPLAY NAME IS "-" WHERE I ASK TO USE THE FIRST NAME BEFORE.

THEN FUCKING BEFORE YOU ADD SIGN UP AND LOGIN BYPASS WHICH VERY FUCKING STUPID, NOT DELETE IT, IT'S MAKE ME CAN'T LOGIN TO THE DASHBOARD.